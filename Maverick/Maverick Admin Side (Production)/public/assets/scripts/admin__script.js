"use-strict";
var stockTableBody=document.getElementById("stock_table_body"),table=document.getElementById("stocks_table"),socket=io("https://maverick-server.herokuapp.com"),changePriceButton=document.getElementById("change_price"),changeNumberButton=document.getElementById("change_number"),select_price_company=document.getElementById("price_data"),select_number_company=document.getElementById("number_data"),new_stock_price=document.getElementById("new_price"),new_stock_number=document.getElementById("new_number"),toast_alert=
document.getElementById("toast_alert"),ph=document.getElementById("phNum"),select_school=document.getElementById("school_data"),BalanceBox=document.getElementById("balance"),addParticipantButton=document.getElementById("add_party"),uid=window.sessionStorage.getItem("uid"),changeBalanceButton=document.getElementById("change_balance"),schoolNameBox=document.getElementById("schoolID"),inc_price=document.getElementById("inc_price"),inc_dec_button=document.getElementById("inc_dec_price"),current_rec,current_stock_numbers,
current_stock_prices,current_self_stocks,body=document.getElementById("page-top"),isFirstTime=!0,phNumber=window.sessionStorage.getItem("number");console.log("This is the phone number:"+phNumber);
var firebaseConfig={apiKey:"AIzaSyD_818rzmgf-CsoxlnGLjcvifkN2VAznH0",authDomain:"maverick-ae0b5.firebaseapp.com",databaseURL:"https://maverick-ae0b5-default-rtdb.firebaseio.com",projectId:"maverick-ae0b5",storageBucket:"maverick-ae0b5.appspot.com",messagingSenderId:"926763134889",appId:"1:926763134889:web:5f1553ae548a93ebec9eb8",measurementId:"G-S81LLWFHBQ"};firebase.initializeApp(firebaseConfig);firebase.analytics();
socket.on("connect",function(){console.log("connected");socket.emit("check_uid",{PHONE:phNumber})});socket.on("security_check_result",function(a){!0===a.ADMIN?body.hidden=!1:!1===a.ADMIN&&(window.sessionStorage.setItem("UNAUTHORIZED_USER","true"),alert("PLEASE LOGIN WITH ADMIN ACCOUNT"),window.location.replace("login.html"))});var database=firebase.database(),party=database.ref("Participants"),market=database.ref("Market"),companyName=database.ref("Market/Companies");
companyName.on("value",function(a){a=a.val();createtable(a.split(",").length);updateCompanyNames(a)});var stocksPrice=database.ref("Market/stocksPrice");stocksPrice.on("value",function(a){a=a.val();updateStockPrice(a)});var schools=database.ref("Participants");schools.on("value",function(a){a=a.val();updateSchoolNames(a)});var stocksNumber=database.ref("Market/stocksLeft");stocksNumber.on("value",function(a){a=a.val();updateStockNumbers(a)});var recStatus=database.ref("Market/rec");
recStatus.on("value",function(a){a=a.val();updateRecStatus(a)});function updateRecStatus(a){current_rec=a.split(",");for(a=1;a<current_rec.length;a++){var b=document.getElementById("cell"+a+1),c=document.getElementById("cell"+a+2);"up"===current_rec[a-1]?(c.innerHTML="\u25b2",c.style.color="#00ff00",document.getElementById("cell"+a+1).style.color="#00ff00"):"down"===current_rec[a-1]&&(c.innerHTML="\u25bc",c.style.color="#ff0000",b.style.color="#ff0000")}}
function updateSchoolNames(a){for(i=select_school.options.length-1;0<=i;i--)select_school.options[i]=null;Object.keys(a).forEach(function(b){var c=a[b].SCHOOL,e=document.getElementById("school_options"),d=document.createElement("option");d.value=b;d.text=c;e.appendChild(d)})}
function updateCompanyNames(a){a=a.split(",");for(var b=1;b<a.length;b++){var c=a[b-1];document.getElementById("cell"+b+0).innerHTML=c;var e=document.getElementById("price_companies"),d=document.getElementById("number_companies"),f=document.createElement("option"),g=document.createElement("option");f.value=b-1;f.text=c;e.appendChild(f);g.value=b-1;g.text=c;d.appendChild(g)}}
function updateStockNumbers(a){current_stock_numbers=a=a.split(",");for(var b=1;b<current_stock_numbers.length;b++)document.getElementById("cell"+b+3).innerHTML=a[b-1]}function updateStockPrice(a){console.log(a);current_stock_prices=a=a.split(",");for(var b=1;b<current_stock_prices.length;b++)document.getElementById("cell"+b+1).innerHTML="R\u00a5 "+a[b-1].toString().bold()}changePriceButton.onclick=changePriceClick;changeNumberButton.onclick=changeNumberClick;addParticipantButton.onclick=addParticipantClick;
function changePriceClick(){var a={PRICE:new_stock_price.value,COMPANY:select_price_company.value,UID:"None"};console.log(JSON.stringify(a));socket.emit("change_price_request",a)}function changeNumberClick(){socket.emit("change_number_request",{NUMBER:new_stock_number.value,COMPANY:select_number_company.value,UID:"NONE"})}function addParticipantClick(){socket.emit("add_participant_request",{TEL_NUMBER:ph.value,SCHOOL:schoolNameBox.value})}
function addAdmin(){var a={PASSWORD:"HareKrishna01#",UID:uid};console.log("sending...");socket.emit("add_admin_request",a)}changeBalanceButton.onclick=changeBalance;function changeBalance(){socket.emit("change_balance_request",{PHONE:select_school.value,BALANCE:BalanceBox.value})}function createtable(a){for(var b=1;b<=a;b++){for(var c=document.createElement("tr"),e=0;4>e;e++){var d=document.createElement("td");d.id="cell"+b+e;c.appendChild(d)}stockTableBody.appendChild(c)}}
inc_dec_button.onclick=inc_dec_click;function inc_dec_click(){var a={PRICE:inc_price.value,COMPANY:select_price_company.value,UID:"None"};console.log(JSON.stringify(a));socket.emit("inc_dec_request",a)};